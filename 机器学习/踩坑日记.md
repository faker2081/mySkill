# 踩坑日记

## 数据读取

来源https://www.kaggle.com/santhraul/methods-to-read-large-datasets

### pandas

#### 减少不必要的内存开支

pandas在读取数据时给数据分配较多的位数，这会导致不必要的内存占用

```python
%%time

dtypes = {
    "row_id": "int64",
    "timestamp": "int64",
    "user_id": "int32",
    "content_id": "int16",
    "content_type_id": "boolean",
    "task_container_id": "int16",
    "user_answer": "int8",
    "answered_correctly": "int8",
    "prior_question_elapsed_time": "float32", 
    "prior_question_had_explanation": "boolean"
}

data = pd.read_csv("../input/riiid-test-answer-prediction/train.csv", dtype=dtypes)
```

删除不需要的dataframe，释放内存

```python
# free memory
del data
import gc
gc.collect()
```



#### 读取一部分数据

读取前1M行

```python
train_data = pd.read_csv('train.csv', nrows=100000)
```

从中间读入

```python
train_data = pd.read_csv('train.csv', skiprows=range(1, 100001), nrows=100000)
```

##### 删除数据以节省RAM 

```python
import gc
del unwanted_dataframe
gc.collect()
```



### 函数参数

###### dataloader

- 在Windows中pytorch中的该方法的num_workwes要设置为0

## kaggle

数据各种读取方式（以及在小内存上训练大数据集）

https://www.kaggle.com/c/tabular-playground-series-oct-2021/discussion/275712

#### LightGBM GPU

如果您想利用 GPU 提供的额外速度，则必须编译并重新安装 LightGBM。如果您不这样做，即使您启用了 GPU，LightGBM 也会简单地恢复使用 CPU。



## 环境配置

#### 超时异常

切换到镜像网站下载

```tex
pip install -i https://pypi.tuna.tsinghua.edu.cn/simple 库名
```

```tex
pip install 包名 -i http://pypi.douban.com/simple/ --trusted-host pypi.douban.com
这个是豆瓣源
--trusted-host pypi.douban.com 这是为了获得ssl证书的认证，要不然会报错
```



#### 安装txt文档中配置好的库方法

在命令行窗口输入以下命令

```tex
python -m pip install -r requirements_my_project.txt
```

说明

- 版本名和版本号之间是两个`==`；
- 不指定版本的，默认是下载最新版本；
- git是下载github上的库包，并安装；
- 每个库包版本之间都要另起一行

```tex
numpy==1.16.1
pathlib==1.0.1
scandir==1.6
h5py==2.7.1
Keras==2.2.4
opencv-python==4.0.0.21
tensorflow-gpu==1.11.0
plaidml-keras==0.5.0
scikit-image
dlib==19.10.0
tqdm
git+https://www.github.com/keras-team/keras-contrib.git
```

