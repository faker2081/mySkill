[toc]

# 启发式算法



## 差分进化算法

### 1. 差分进化算法简介

（以下描述，均不是学术用语，仅供大家快乐的阅读）
 　差分进化算法（Differential Evolution Algorithm，DE）是一种基于群体的进化算法，它模拟了群体中的个体的合作与竞争的过程。算法原理简单，控制参数少，只有交叉概率和缩放比例因子，鲁棒性强，易于实现。
 　差分进化算法中，每一个个体的基因表示待求问题的一个候选解。每次迭代将先进行变异操作，选择一个或多个个体的基因作为基，然后选择不同的个体的差分来构成差分基因，最后将作为基的基因与差分基因相加来得出新的个体。交叉操作将新的个体将于父代的对应个体交叉，然后进行选择操作，比较交叉后的个体与父代的对应个体，选择较优的个体保留至下一代。在迭代完成之后将选择种群中最优个体的基因作为解。
 　差分进化算法可以算是我所使用过的优化算法中大魔王级别的算法，虽然它每个方面都没有强到离谱，但是综合起来的效果好于大多数算法。它就像一个每个科目都能考到90分（百分制）的学生，虽然没门课都不是最优秀的，但是论综合，论总分，它有极大的概率是第一名。



![img](https:////upload-images.jianshu.io/upload_images/18209951-506ccf3dedd1e953.png?imageMogr2/auto-orient/strip|imageView2/2/w/1200/format/webp)

（两位（正经）魔王，一位宇宙帝王，一位蚁王，蚁王更符合差分进化算法，因为他可以不断的吞食其他个体并吸收他们的能力从而不断变强，是不是和优化算法很像？富坚老贼还是狠）



　　在我研究优化算法的小路上，我的目标就是找到一个能打败大魔王或是能在大多数方面压制魔王的算法。

### 2. 算法流程

这次的主角就选魔王军吧（或者蚁王军，为了与蚁群算法区别还是叫魔王军吧），个体则称之为魔王兵。
 　魔王兵的能力取决于它们的基因，它们可以根据环境或者需要改变自己的基因使得自己更加强大，更方便的处理问题，问题的维度与基因维度相同。
 　　　　![X_i^t=(x_{i,1}^t,x_{i,2}^t,...,x_{i,D}^t)](https://math.jianshu.com/math?formula=X_i%5Et%3D(x_%7Bi%2C1%7D%5Et%2Cx_%7Bi%2C2%7D%5Et%2C...%2Cx_%7Bi%2CD%7D%5Et))
 　表示第i个魔王兵在进化了第t次后的基因，该个体有D位基因。
 与遗传算法同为进化算法的差分进化算法，它们的操作（算子）也都非常相似的，都是交叉，变异和选择，流程也几乎一样（遗传算法先交叉后变异，差分进化算法先变异后交叉）。

![img](https:////upload-images.jianshu.io/upload_images/18209951-caad88fa396eccb1.png?imageMogr2/auto-orient/strip|imageView2/2/w/424/format/webp)



### 2.1变异

说到差分进化算法中的变异，我就想到一句论语**“三人行，必有我师焉。择其善者而从之，其不善者而改之。”**，其实这句论语已经向我们说明了差分进化算法的整个流程：
 　“三人行，必有我师焉”——变异，交叉。
 　“择其善者而从之，其不善者而改之”——选择。
 　差分进化算法中，当一个魔王兵变异时，它会先找来3个小伙伴，当然是随机找来3个小伙伴，避免同化。在一个小伙伴的基因上加上另外两个小伙伴基因之差作为自己的目标基因。其变异公式如下：
 　　　　　![U_i=X_{r1}+F(X_{r2}-X_{r3})](https://math.jianshu.com/math?formula=U_i%3DX_%7Br1%7D%2BF(X_%7Br2%7D-X_%7Br3%7D))
 　表示第i个魔王兵找到了编号为r1、r2和r3的三个魔王兵，当然了i、r1、r2、r3为互不相同的整数，F为缩放比例因子，通常 ，一般取F=0.5。![U_i](https://math.jianshu.com/math?formula=U_i)为第i个魔王兵交叉后的目标基因图纸，不过这是个半成品，再经过交叉后，目标基因图纸才算完成。
 　其实现在我们已经有了5个基因图纸了![U_i,X_i,X_{r1},X_{r2},X_{r3}](https://math.jianshu.com/math?formula=U_i%2CX_i%2CX_%7Br1%7D%2CX_%7Br2%7D%2CX_%7Br3%7D)，接下来将进行交叉操作。由于变异操作，差分进化算法的种群中个体数至少为4，即魔王军中至少有4个小兵。

### 2.2交叉

交叉操作中，魔王兵i会将目标基因图纸 ![U_i^t=(u_{i,1}^t,u_{i,2}^t,...,u_{i,D}^t)](https://math.jianshu.com/math?formula=U_i%5Et%3D(u_%7Bi%2C1%7D%5Et%2Cu_%7Bi%2C2%7D%5Et%2C...%2Cu_%7Bi%2CD%7D%5Et))进行加工得到 ![V_i^t=(v_{i,1}^t,v_{i,2}^t,...,v_{i,D}^t)](https://math.jianshu.com/math?formula=V_i%5Et%3D(v_%7Bi%2C1%7D%5Et%2Cv_%7Bi%2C2%7D%5Et%2C...%2Cv_%7Bi%2CD%7D%5Et))，加工过程如下：
 ![v_{i,d}=\begin{cases} u_{i,d},rand(0,1)<CR \ \ or\ \ d = d_{rand} \\ x_{i,d},rand(0,1) \geq CR \ \ or\ \ d \neq d_{rand} \end{cases}](https://math.jianshu.com/math?formula=v_%7Bi%2Cd%7D%3D%5Cbegin%7Bcases%7D%20u_%7Bi%2Cd%7D%2Crand(0%2C1)%3CCR%20%5C%20%5C%20or%5C%20%5C%20d%20%3D%20d_%7Brand%7D%20%5C%5C%20x_%7Bi%2Cd%7D%2Crand(0%2C1)%20%5Cgeq%20CR%20%5C%20%5C%20or%5C%20%5C%20d%20%5Cneq%20d_%7Brand%7D%20%5Cend%7Bcases%7D)
 　其中 。 为交叉概率，其值越大，发生交叉的概率越大，一般取 。 ![d_{rand}](https://math.jianshu.com/math?formula=d_%7Brand%7D)为{1,2,…,D}中的随机整数，其作用是保证交叉操作中至少有一维基因来自变异操作产生的基因，不能让交叉操作的努力白费。
 　从公式上可以看出交叉操作实际上是从变异操作得出的基因图纸上选择至少一位基因来替换自己的等位基因，得到最终的基因图纸。

### 2.3选择

选择操作相对简单，魔王兵i拿到了最终的基因图纸 ![V_i^t=(v_{i,1}^t,v_{i,2}^t,...,v_{i,D}^t)](https://math.jianshu.com/math?formula=V_i%5Et%3D(v_%7Bi%2C1%7D%5Et%2Cv_%7Bi%2C2%7D%5Et%2C...%2Cv_%7Bi%2CD%7D%5Et))，大喊一声，进化吧，魔王兵i的基因改变了。它拿出了能力测量器fitness function,如果发现自己变强了，那么就将基因 保留到下一代，否则它选择放弃进化，让自己还原成 ![X_i^t=(x_{i,1}^t,x_{i,2}^t,...,x_{i,D}^t)](https://math.jianshu.com/math?formula=X_i%5Et%3D(x_%7Bi%2C1%7D%5Et%2Cx_%7Bi%2C2%7D%5Et%2C...%2Cx_%7Bi%2CD%7D%5Et))。





## 天牛须算法

### 算法模型



​       BAS算法主要是通过在不停的左右触角气味浓度比对中前进，同其他算法相比，原理十分简单。

##### 触角位置

​       在进行两只触角气味浓度计算之前，需要对其进行一系列准备工作，在D维空间中天牛的位置为

$ X = ( x_1 , x_2 , . . . , x_n ) $，天牛左右两只触角的位置被定义为如下公式所示模型：
$$
\left\{
\begin{aligned}


X_r & = & X + l * \vec d \\

X_l & = & X - l * \vec d

\end{aligned}

\right. \tag{1}
$$


上式中，$l$ 表示天牛质心与触须的距离；$\vec d$ 表示随即单位向量，需对其进行归一化操作
$$
\vec d = \frac {r a n d s ( D , 1 )} {∥ r a n d s ( D , 1 ) ∥_2 } \tag{2}
$$

##### 天牛位置更新

根据左右两根触角感知的气味浓度差进行对比，判断天牛下一步的位置：
$$
X_
{t+1}
 =X_t
 +δ_t
 ∗ 
\vec d
 ∗sign[f(X 
_r
 )−f(X _l)] \tag{3}
$$
式中，$t$ 表示当前的迭代次数；$f ( . ) $ 表示适应度函数；$δ _t$ 表示第t 次迭代时的探索步长，$s i g n ( . ) $ 函数为符号函数，各个变量的具体定义为：
$$
\begin{eqnarray*}
δ_{t + 1} = δ t ∗ e t a   \tag{4} \\

\\
\\

sign(x) = \left\{

\begin{aligned}


1 , if \ \ x > 0 \\

0 , if \ \ x = 0 \\
-1, otherwise

\end{aligned}

\right. \tag{5}
\end{eqnarray*}
$$
其中eta在0,1之间靠近1，通常可取eta=0.95。(eta为超参数)


```tex
需要注意的是，在处理不同的优化目标时公式3 的 + 不是固定的，根据优化的目标为最大值或者最小值，适当对其进行改变。
```
### 流程

输入：解空间维度、最大迭代次数、初始步长；
输出：极值点g_best；
Step1：初始化步长衰减因子、狩猎空间，位置信息X
Step2：根据公式(2)进行归一化处理；
Step3：根据公式(1)确定天牛的左须与右须位置；
Step4：根据公式(3)更新天牛的位置
Step5 ：计算天牛位置的适应度函数值并存储，更新步长；
Step6 ：判断是否达到迭代终止条件，若是则输出全局最优解，否则跳转至Step2。



## 创新点 

- 离散天牛须算法：把天牛的位置变为0、1的离散向量

- 离散天牛须变异：(天牛的位置更新)

  1.  天牛位置($B^D$ 表示变异天牛)

  $$
  \begin{equation}
  B_j^D = [c_1,c_2,...,c_n],x_i \in \{0,1\} \tag{1}
  \end{equation}
  $$

  2. 挑选变异因子,变异因子个数由sum(B)确定。差分算法中一个粒子对应一个B
     $$
     choosed = B_i^D*X_i \tag{2}
     $$

  3. 执行变异
     $$
     U_i = choose_1 + F*(choose_2 + choose_3) \tag{3}
     $$

- 离散天牛须交叉：（$B^C$ 表示交叉天牛）
  鉴于差分算法是随机交叉的，且每次随机都相互独立，不存在关联性，现考虑使用天牛须算法给差分算法的交叉环节增加一点马尔科夫性
  $$
  \begin{eqnarray*}
  B_j^C = [c_1,c_2,...,c_n],x_i \in \{0,1\} \tag{4}
  \\ \\
  
  V = B_i^C * U + (ones-B_i^C) * X_i \tag{5}
  \end{eqnarray*}
  $$

其他步骤和原来的一样，另外"离散天牛须算法"的位置更新用差分算法的适应度函数。

### 代码思路

#### 离散天牛须

##### 需要数据结构

- 环形数组（仅仅意义结构上）
- 

